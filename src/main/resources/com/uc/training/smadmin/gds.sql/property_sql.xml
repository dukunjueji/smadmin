<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE sqlMap PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN" "http://ibatis.apache.org/dtd/sql-map-2.dtd" >
<sqlMap namespace="com.uc.training.smadmin.gds.dao.PropertyDao">
    <!--新增商品属性-->
    <insert id="insertProperty" parameterClass="com.uc.training.smadmin.gds.model.Property">
        INSERT INTO t_gds_property
        (goods_id, stock, discount_price, sale_price, property, is_discount, create_emp, modify_emp)
        VALUES (#goodsId#,#stock#,#discountPrice#,#salePrice#,#property#,#isDiscount#,#createEmp#,#modifyEmp#)
        <selectKey resultClass="java.lang.Long" keyProperty="id">
            SELECT LAST_INSERT_ID() as id;
        </selectKey>
    </insert>
    <!--删除商品属性-->
    <delete id="deletePropertyById" parameterClass="Long">
      DELETE FROM  t_gds_property
      WHERE id = #id#
    </delete>

    <!--更新商品属性-->
    <update id="updateProperty" parameterClass="com.uc.training.smadmin.gds.model.Property">
        UPDATE t_gds_property
        SET   stock=#stock#,
              discount_price=#discountPrice#,
              sale_price=#salePrice#,
              property=#property#,
              is_discount=#isDiscount#,
              modify_emp=#modifyEmp#
        WHERE goods_id = #goodsId#
    </update>

    <!--后台通过商品id获取商品属性-->
    <select id="getPropertyListByGoodsId" parameterClass="Long" resultClass="com.uc.training.smadmin.gds.re.AdminPropertyListRE">
        SELECT
            gp.id AS id,
            gp.goods_id AS goodsId,
            gp.stock AS stock,
            gp.discount_price AS discountPrice,
            gp.sale_price AS  salePrice,
            gp.property AS property,
            gp.is_discount AS isDiscount
        FROM   t_gds_property gp
        WHERE gp.goods_id = #goodsId#
    </select>

    <!--后台通过主键id查找该商品的商品属性的数量-->
    <select id="getGoodsIdCountById" parameterClass="Long" resultClass="Integer">
        SELECT count(1)
        FROM t_gds_property
        WHERE goods_id = (
                          SELECT goods_id
                          FROM t_gds_property
                          WHERE id = #id#)
    </select>

    <!--后台通过主键id查找该商品的状态-->
    <select id="getGoodsStatusById" parameterClass="Long" resultClass="Integer">
        select `status`
        from t_gds_goods gg
        where  gg.id = (
                          select goods_id
                          from t_gds_property
                          where id = #id#)
    </select>



    <!-- 通过商品id查找商品属性数量 -->
    <select id="getPropertyIdListByGoodsId" parameterClass="Long" resultClass="Long">
        SELECT
          id
        FROM
          t_gds_property
        WHERE goods_id = #goodsId#
    </select>
</sqlMap>